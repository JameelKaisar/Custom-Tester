{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./demo/main.js","webpack:///./probnik/probe.ts","webpack:///./probnik/probes/browser_probe.ts","webpack:///./probnik/probes/pulse_probe.ts","webpack:///./probnik/probnik.ts","webpack:///./probnik/recipe_providers/http_recipe_provider.ts","webpack:///./probnik/recipe_providers/local_recipe_provider.ts","webpack:///./probnik/requesters/xhr_requester.ts","webpack:///./probnik/testers/http_tester.ts","webpack:///./probnik/testers/testers.ts"],"names":[],"mappings":";QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;;AClFA;AAAA;AAAA;AAAyE;;AAEzE,yBAAyB,sEAAkB;;AAE3C;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,gBAAgB,gEAAY;AAC5B;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;;;;;;;AChCa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,cAAc;;;;;;;;;;;;;AClB/C;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,gBAAgB,sCAAsC,iBAAiB,EAAE;AACvF,6BAA6B,uDAAuD;AACpF;AACA;AACA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA,CAAC;AACD,8CAA8C,cAAc;AAC5D;AACA;AACA;AACA;AACA,oBAAoB,mBAAO,CAAC,sDAAe;AAC3C,sBAAsB,mBAAO,CAAC,0EAA6B;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;;;;;;;;;;;;;ACjDa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,cAAc;AAC5D;AACA,gBAAgB,mBAAO,CAAC,wDAAoB;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kDAAkD,OAAO;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,2CAA2C,QAAQ;AACnD;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,gBAAgB,sBAAsB,kBAAkB,EAAE;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;;;;;;;;;;;;;AC9Ja;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC,oCAAoC,aAAa,EAAE,EAAE;AACvF,CAAC;AACD;AACA;AACA,CAAC;AACD;AACA;AACA;AACA,8CAA8C,cAAc;AAC5D;AACA;AACA;AACA,aAAa,mBAAO,CAAC,mCAAS;AAC9B,aAAa,mBAAO,CAAC,iEAAwB;AAC7C,aAAa,mBAAO,CAAC,mGAAyC;AAC9D,aAAa,mBAAO,CAAC,qGAA0C;;;;;;;;;;;;;ACnClD;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,cAAc;AAC5D;AACA,sBAAsB,mBAAO,CAAC,0EAA6B;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC,sBAAsB,EAAE;AAC/D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wDAAwD,OAAO;AAC/D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS,GAAG,oBAAoB;AAChC;AACA;AACA,CAAC;AACD;AACA;;;;;;;;;;;;;AC7Ga;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,cAAc;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;;;;;;;;;;;;;ACrCa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,cAAc;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,wBAAwB;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB;AACpB;AACA;AACA;AACA;AACA,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;;;;;;;;;;;;;ACrMa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,cAAc;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6DAA6D,qBAAqB;AAClF;AACA;AACA,CAAC;AACD;;;;;;;;;;;;;ACjCa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,cAAc;AAC5D;AACA,oBAAoB,mBAAO,CAAC,uDAAe;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./demo/main.js\");\n","import { RestRecipeProvider, BrowserProbe } from '../probnik/probnik.ts';\n\nvar recipeProvider = new RestRecipeProvider('/recipe');\n\nvar toggleButton = document.getElementById('toggle-button');\nvar testingMessage = document.getElementById('testing-message');\n\nvar testerIsActive = false;\n\nvar probeTimer = null;\n\nfunction onComplete(data) {\n    if (testerIsActive) {\n        handleData(data);\n        probeTimer = setTimeout(runProbe, 500);\n    }\n}\n\nfunction runProbe() {\n    var t = new BrowserProbe(recipeProvider, onComplete);\n    t.start();\n}\n\nfunction toggleTest() {\n    toggleButton.innerHTML = testerIsActive ? 'Start' : 'Stop';\n    testingMessage.innerHTML = testerIsActive ? '' : 'Testing...';\n    testerIsActive = !testerIsActive;\n    clearTimeout(probeTimer);\n    if (testerIsActive)\n        runProbe();\n}\n\ntoggleButton.addEventListener('click', toggleTest);\n\n","\"use strict\";\n/**\n *\n *  Copyright 2019 Netflix, Inc.\n *\n *     Licensed under the Apache License, Version 2.0 (the \"License\");\n *     you may not use this file except in compliance with the License.\n *     You may obtain a copy of the License at\n *\n *         http://www.apache.org/licenses/LICENSE-2.0\n *\n *     Unless required by applicable law or agreed to in writing, software\n *     distributed under the License is distributed on an \"AS IS\" BASIS,\n *     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *     See the License for the specific language governing permissions and\n *     limitations under the License.\n *\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n","\"use strict\";\n/**\n *\n *  Copyright 2019 Netflix, Inc.\n *\n *     Licensed under the Apache License, Version 2.0 (the \"License\");\n *     you may not use this file except in compliance with the License.\n *     You may obtain a copy of the License at\n *\n *         http://www.apache.org/licenses/LICENSE-2.0\n *\n *     Unless required by applicable law or agreed to in writing, software\n *     distributed under the License is distributed on an \"AS IS\" BASIS,\n *     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *     See the License for the specific language governing permissions and\n *     limitations under the License.\n *\n */\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.BrowserProbe = void 0;\n/**\n * Probe implementation to run in a browser.\n */\nvar pulse_probe_1 = require(\"./pulse_probe\");\nvar xhr_requester_1 = require(\"../requesters/xhr_requester\");\n/**\n * Probe implementation to run in a browser.\n */\nvar BrowserProbe = /** @class */ (function (_super) {\n    __extends(BrowserProbe, _super);\n    function BrowserProbe() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    return BrowserProbe;\n}(pulse_probe_1.PulseProbe));\nexports.BrowserProbe = BrowserProbe;\nBrowserProbe.requester = new xhr_requester_1.XhrHttpRequester();\n","\"use strict\";\n/**\n *\n *  Copyright 2019 Netflix, Inc.\n *\n *     Licensed under the Apache License, Version 2.0 (the \"License\");\n *     you may not use this file except in compliance with the License.\n *     You may obtain a copy of the License at\n *\n *         http://www.apache.org/licenses/LICENSE-2.0\n *\n *     Unless required by applicable law or agreed to in writing, software\n *     distributed under the License is distributed on an \"AS IS\" BASIS,\n *     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *     See the License for the specific language governing permissions and\n *     limitations under the License.\n *\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.PulseProbe = void 0;\nvar testers_1 = require(\"../testers/testers\");\n/**\n * Probe implementation\n */\nvar PulseProbe = /** @class */ (function () {\n    /**\n     * @param recipeProvider An object that provides Recipe to test against.\n     * @param reporter A reporter to use to send Probe results to.\n     */\n    function PulseProbe(recipeProvider, reporter) {\n        this.recipeProvider = recipeProvider;\n        this.reporter = reporter;\n        this.iteration = 0;\n        this.completed = false;\n        this.requester = this.constructor.requester;\n        this.testerFactory = this.constructor.testerFactory;\n    }\n    /** Starts/resumes execution of the test. */\n    PulseProbe.prototype.start = function () {\n        if (this.nextJob) {\n            // Already started\n            return;\n        }\n        // TODO: should we allow running the test from the same Probnik object several times?\n        // Isn't the iteration property created exactly for this purpose?\n        if (this.completed) {\n            // The test session is completed\n            return;\n        }\n        this.nextJob = this.scheduleAfter(0, this.run.bind(this));\n    };\n    /** Stops execution of the test. */\n    PulseProbe.prototype.stop = function () {\n        if (this.nextJob) {\n            this.nextJob.cancel();\n            this.nextJob = undefined;\n        }\n    };\n    /** Runs the test. */\n    PulseProbe.prototype.run = function () {\n        this.recipeProvider.getRecipe(this.iteration, this.executeTest.bind(this));\n    };\n    PulseProbe.prototype.forEachTarget = function (recipe, fn) {\n        for (var i = 0, l = recipe.targets.length; i < l; i++) {\n            fn.bind(this)(recipe.targets[i]);\n        }\n    };\n    PulseProbe.prototype.executeTest = function (recipe) {\n        if (!recipe) {\n            // Invalid test recipe, abort\n            this.stop();\n            return;\n        }\n        var tester = this.testerFactory.getTester(this.requester, recipe);\n        var reports = [];\n        var wg = new WaitGroup(recipe.targets.length);\n        var scheduleAfter = this.scheduleAfter;\n        this.forEachTarget(recipe, function (target) {\n            var pulses = [];\n            var handler = function (done, report) {\n                pulses.push(report);\n                done();\n            };\n            var nested = function finish() {\n                reports.push({\n                    'name': target.name,\n                    'target': target.target,\n                    'data': pulses\n                });\n                wg.done();\n            };\n            for (var i = recipe.pulses - 1; i >= 0; i--) {\n                nested = (function probe(next, delay) {\n                    var task = tester.run.bind(tester, target, handler.bind(null, next));\n                    scheduleAfter(delay, task);\n                }).bind(null, nested, i > 0 ? recipe.pulse_delay : 0);\n            }\n            // Unwrap timeout(0), probe, timeout(delay), probe, timeout(delay), probe, finish\n            nested();\n        });\n        var finish = this.handleResult.bind(this);\n        wg.wait(function () {\n            finish(recipe, reports);\n        });\n    };\n    PulseProbe.prototype.scheduleAfter = function (delayMilliseconds, task) {\n        var id = setTimeout(task, delayMilliseconds);\n        return { cancel: function () { clearTimeout(id); } };\n    };\n    PulseProbe.prototype.handleResult = function (recipe, reports) {\n        // Use the injected logger to log report\n        this.reporter({\n            ctx: recipe.ctx,\n            name: recipe.name,\n            type: recipe.type,\n            data: reports\n        });\n        // Schedule next round if necessary\n        if (!this.nextJob) {\n            // Tester is stopped\n            return;\n        }\n        if (recipe.next > 0) {\n            this.nextJob = this.scheduleAfter(recipe.next, this.run.bind(this));\n        }\n        else {\n            this.completed = true;\n            this.stop();\n        }\n    };\n    return PulseProbe;\n}());\nexports.PulseProbe = PulseProbe;\n/**\n * Syncronizes ProbeTester runs between pulses.\n */\nvar WaitGroup = /** @class */ (function () {\n    function WaitGroup(total) {\n        this.total = total;\n    }\n    WaitGroup.prototype.done = function () {\n        this.total--;\n        if (this.total === 0 && this.cb) {\n            this.cb();\n            this.cb = undefined;\n        }\n    };\n    WaitGroup.prototype.wait = function (cb) {\n        if (this.total === 0) {\n            cb();\n        }\n        else {\n            this.cb = cb;\n        }\n    };\n    return WaitGroup;\n}());\n;\nPulseProbe.testerFactory = new testers_1.TesterFactory();\n","\"use strict\";\n/**\n *\n *  Copyright 2019 Netflix, Inc.\n *\n *     Licensed under the Apache License, Version 2.0 (the \"License\");\n *     you may not use this file except in compliance with the License.\n *     You may obtain a copy of the License at\n *\n *         http://www.apache.org/licenses/LICENSE-2.0\n *\n *     Unless required by applicable law or agreed to in writing, software\n *     distributed under the License is distributed on an \"AS IS\" BASIS,\n *     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *     See the License for the specific language governing permissions and\n *     limitations under the License.\n *\n */\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Exports\n */\n__exportStar(require(\"./probe\"), exports);\n__exportStar(require(\"./probes/browser_probe\"), exports);\n__exportStar(require(\"./recipe_providers/http_recipe_provider\"), exports);\n__exportStar(require(\"./recipe_providers/local_recipe_provider\"), exports);\n","\"use strict\";\n/**\n *\n *  Copyright 2019 Netflix, Inc.\n *\n *     Licensed under the Apache License, Version 2.0 (the \"License\");\n *     you may not use this file except in compliance with the License.\n *     You may obtain a copy of the License at\n *\n *         http://www.apache.org/licenses/LICENSE-2.0\n *\n *     Unless required by applicable law or agreed to in writing, software\n *     distributed under the License is distributed on an \"AS IS\" BASIS,\n *     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *     See the License for the specific language governing permissions and\n *     limitations under the License.\n *\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.RestRecipeProvider = void 0;\nvar xhr_requester_1 = require(\"../requesters/xhr_requester\");\nfunction isObject(o) {\n    return !!(o && (\"object\" === typeof o));\n}\nfunction isArray(a) {\n    return Object.prototype.toString.call(a) === '[object Array]';\n}\nfunction isInt(v) {\n    return !isNaN(v) && (function (x) { return (x | 0) === x; })(parseFloat(v));\n}\nfunction isString(v) {\n    return typeof v === 'string';\n}\n/**\n* Provides Probnik recipe based on an output of a REST HTTP endpoint.\n* When acked to provide a recipe, performs an HTTP GET call on a configured URL and provides\n* the result back to the caller.\n*/\nvar RestRecipeProvider = /** @class */ (function () {\n    /**\n     * @param url URL of an API endpoint to call to get a recipe.\n     */\n    function RestRecipeProvider(url) {\n        this.url = url;\n    }\n    /** Provides recipe to test. */\n    RestRecipeProvider.prototype.getRecipe = function (iteration, cb) {\n        var url = this.url;\n        var delimiter = url.indexOf('?') === -1 ? '?' : '&';\n        url = \"\" + url + delimiter + \"iteration=\" + iteration;\n        RestRecipeProvider.requester.getData(url, 0, function (status, headers, body) {\n            if (status != 200 || body == null) {\n                cb(null);\n                return;\n            }\n            try {\n                var json = JSON.parse(body);\n                var errPrefix = 'FTLTester: param';\n                if (!isObject(json)) {\n                    throw new Error(errPrefix + \": not an object\");\n                }\n                if (!isInt(json.next)) {\n                    throw new Error(errPrefix + \".next: not an integer\");\n                }\n                if (!isInt(json.pulses)) {\n                    throw new Error(errPrefix + \".pulses: not an integer\");\n                }\n                if (!isInt(json.pulse_delay)) {\n                    throw new Error(errPrefix + \".pulse_delay: not an integer\");\n                }\n                if (!isInt(json.pulse_timeout)) {\n                    throw new Error(errPrefix + \".pulse_timeout: not an integer\");\n                }\n                if (!isString(json.name)) {\n                    throw new Error(errPrefix + \".name: not a string\");\n                }\n                if (!isObject(json.ctx)) {\n                    throw new Error(errPrefix + \".ctx: not an object\");\n                }\n                if (!isArray(json.targets)) {\n                    throw new Error(errPrefix + \".targets: not an array\");\n                }\n                for (var i = 0, l = json.targets.length; i < l; i++) {\n                    var targetInfo = json.targets[i];\n                    if (!isObject(targetInfo)) {\n                        throw new Error(errPrefix + \".targets[\" + i + \"]: not an object\");\n                    }\n                    if (!isString(targetInfo.name)) {\n                        throw new Error(errPrefix + \".targets[\" + i + \"].name: not a string\");\n                    }\n                    if (!isString(targetInfo.target)) {\n                        throw new Error(errPrefix + \".targets[\" + i + \"].target: not a string\");\n                    }\n                }\n                var params = json;\n                cb(params);\n            }\n            catch (e) {\n                if (console && console.error) {\n                    console.error(e);\n                }\n                cb(null);\n                return;\n            }\n        }, { withCookies: true });\n    };\n    return RestRecipeProvider;\n}());\nexports.RestRecipeProvider = RestRecipeProvider;\nRestRecipeProvider.requester = new xhr_requester_1.XhrHttpRequester();\n","\"use strict\";\n/**\n *\n *  Copyright 2019 Netflix, Inc.\n *\n *     Licensed under the Apache License, Version 2.0 (the \"License\");\n *     you may not use this file except in compliance with the License.\n *     You may obtain a copy of the License at\n *\n *         http://www.apache.org/licenses/LICENSE-2.0\n *\n *     Unless required by applicable law or agreed to in writing, software\n *     distributed under the License is distributed on an \"AS IS\" BASIS,\n *     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *     See the License for the specific language governing permissions and\n *     limitations under the License.\n *\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.LocalRecipeProvider = void 0;\n/**\n * Provides Probnik recipe based on provided provided during an initialization.\n */\nvar LocalRecipeProvider = /** @class */ (function () {\n    /**\n     * @param url URL of an API endpoint to call to get a recipe.\n     */\n    function LocalRecipeProvider(json) {\n        this.json = json;\n        this.recipe = json;\n    }\n    /** Provides recipe to test. */\n    LocalRecipeProvider.prototype.getRecipe = function (iteration, cb) {\n        cb(this.recipe);\n    };\n    return LocalRecipeProvider;\n}());\nexports.LocalRecipeProvider = LocalRecipeProvider;\n","\"use strict\";\n/**\n *\n *  Copyright 2019 Netflix, Inc.\n *\n *     Licensed under the Apache License, Version 2.0 (the \"License\");\n *     you may not use this file except in compliance with the License.\n *     You may obtain a copy of the License at\n *\n *         http://www.apache.org/licenses/LICENSE-2.0\n *\n *     Unless required by applicable law or agreed to in writing, software\n *     distributed under the License is distributed on an \"AS IS\" BASIS,\n *     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *     See the License for the specific language governing permissions and\n *     limitations under the License.\n *\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.XhrHttpRequester = void 0;\nfunction getXhr() {\n    return new XMLHttpRequest();\n}\nfunction now() {\n    if (window.performance && window.performance.now) {\n        // Use monotonic clock when available\n        return performance.now();\n    }\n    return new Date().getTime();\n}\n// Build HttpMetrics with calculated metrics or performance API metrics if available.\nfunction getReport(url, status, size, start, duration, ttfb, headers) {\n    var report = {\n        start: start,\n        size: size,\n        d: duration,\n        ttfb: ttfb,\n        sc: status\n    };\n    if (headers) {\n        report.via = headers.via;\n    }\n    if (!url || !window.performance || !window.performance.getEntriesByName) {\n        return report;\n    }\n    var entries = window.performance.getEntriesByName(url);\n    if (entries.length == 0) {\n        // In the case the URL does not have a path (i.e.: http://domain.com), the browser\n        // adds a trailing slash and thus the entry might not match. Try again by adding the\n        // slash by ourself.\n        entries = window.performance.getEntriesByName(url + '/');\n        if (entries.length == 0) {\n            return report;\n        }\n    }\n    var timing = entries[entries.length - 1];\n    if ('decodedBodySize' in timing && timing.decodedBodySize > 0) {\n        report.size = timing.decodedBodySize;\n    }\n    if (timing.duration) {\n        report.d = timing.duration;\n    }\n    else if (timing.startTime && timing.responseEnd) {\n        report.d = timing.responseEnd - timing.startTime;\n    }\n    if (timing.requestStart) {\n        report.dns = timing.domainLookupEnd - timing.domainLookupStart;\n        report.ttfb = timing.responseStart - timing.startTime;\n        report.tcp = timing.connectEnd - timing.connectStart;\n        // secureConnectionStart can be 0 instead of timestamp when connection is reused\n        if (timing.secureConnectionStart === 0) {\n            // Chrome has a known bug setting the secureConnectionStart to 0 when the\n            // TLS connection is reused. The spec says that 0 should be used when TLS\n            // is not used. Probes are always HTTPS to avoid mixed content issue,\n            // so it is safe to assume that 0 means reused and not HTTP.\n            report.tls = 0;\n        }\n        else if (timing.secureConnectionStart !== undefined) {\n            report.tls = timing.connectEnd - timing.secureConnectionStart;\n            // The TCP metric must not include the TLS handshake (we want to\n            // approximate the TCP handshake time).\n            report.tcp -= report.tls;\n        }\n    }\n    return report;\n}\nfunction parseHeaders(headerStr) {\n    var headers = {};\n    if (!headerStr) {\n        return headers;\n    }\n    var headerPairs = headerStr.split('\\u000d\\u000a');\n    for (var i = 0; i < headerPairs.length; i++) {\n        var headerPair = headerPairs[i];\n        // Can't use split() here because it does the wrong thing\n        // if the header value has the string \": \" in it.\n        var index = headerPair.indexOf('\\u003a\\u0020');\n        if (index > 0) {\n            var key = headerPair.substring(0, index).toLowerCase();\n            var val = headerPair.substring(index + 2);\n            headers[key] = val;\n        }\n    }\n    return headers;\n}\n/**\n * Runs HTTP Probe tests using XHR object.\n */\nvar XhrHttpRequester = /** @class */ (function () {\n    function XhrHttpRequester() {\n    }\n    XhrHttpRequester.prototype.get = function (url, timeout, cb, options) {\n        var req;\n        try {\n            req = getXhr();\n        }\n        catch (e) {\n            cb(getReport(url, 0, 0, 0, 0, 0));\n            return;\n        }\n        if (!('withCredentials' in req)) {\n            // Missing CORS support\n            cb(getReport(url, 0, 0, 0, 0, 0));\n            return;\n        }\n        if (options.withCookies) {\n            req.withCredentials = true;\n        }\n        if (timeout) {\n            req.timeout = timeout;\n        }\n        var start = now();\n        var ttfb = 0;\n        req.open('GET', url, true);\n        req.onreadystatechange = function () {\n            switch (req.readyState) {\n                case 2:\n                    ttfb = now() - start;\n                    break;\n                case 4:\n                    var headers = {};\n                    if ('getAllResponseHeaders' in req) {\n                        headers = parseHeaders(req.getAllResponseHeaders());\n                    }\n                    var body = req.responseText;\n                    var length_1 = body.length;\n                    if (req.response) {\n                        length_1 = req.response.length;\n                    }\n                    var duration = now() - start;\n                    cb(getReport(url, req.status, length_1, start, duration, ttfb, headers));\n                    break;\n            }\n        };\n        req.send();\n    };\n    XhrHttpRequester.prototype.getData = function (url, timeout, cb, options) {\n        var req;\n        try {\n            req = getXhr();\n        }\n        catch (e) {\n            cb(0, {}, null);\n            return;\n        }\n        if (!('withCredentials' in req)) {\n            // Missing CORS support\n            cb(0, {}, null);\n            return;\n        }\n        if (options.withCookies) {\n            req.withCredentials = true;\n        }\n        if (timeout) {\n            req.timeout = timeout;\n        }\n        var start = now();\n        req.open('GET', url, true);\n        req.onreadystatechange = function () {\n            switch (req.readyState) {\n                case 4:\n                    var headers = {};\n                    if ('getAllResponseHeaders' in req) {\n                        headers = parseHeaders(req.getAllResponseHeaders());\n                    }\n                    var body = req.responseText;\n                    if (req.response) {\n                        length = req.response.length;\n                    }\n                    cb(req.status, headers, body);\n                    break;\n            }\n        };\n        req.send();\n    };\n    return XhrHttpRequester;\n}());\nexports.XhrHttpRequester = XhrHttpRequester;\n","\"use strict\";\n/**\n *\n *  Copyright 2019 Netflix, Inc.\n *\n *     Licensed under the Apache License, Version 2.0 (the \"License\");\n *     you may not use this file except in compliance with the License.\n *     You may obtain a copy of the License at\n *\n *         http://www.apache.org/licenses/LICENSE-2.0\n *\n *     Unless required by applicable law or agreed to in writing, software\n *     distributed under the License is distributed on an \"AS IS\" BASIS,\n *     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *     See the License for the specific language governing permissions and\n *     limitations under the License.\n *\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.HttpTester = void 0;\n/**\n * Test performance of HTTP(s) GET endpoint.\n */\nvar HttpTester = /** @class */ (function () {\n    function HttpTester(requester, timeout) {\n        this.requester = requester;\n        this.timeout = timeout;\n    }\n    HttpTester.prototype.run = function (target, cb) {\n        this.requester.get(target.target, this.timeout, cb, { withCookies: false });\n    };\n    return HttpTester;\n}());\nexports.HttpTester = HttpTester;\n","\"use strict\";\n/**\n *\n *  Copyright 2019 Netflix, Inc.\n *\n *     Licensed under the Apache License, Version 2.0 (the \"License\");\n *     you may not use this file except in compliance with the License.\n *     You may obtain a copy of the License at\n *\n *         http://www.apache.org/licenses/LICENSE-2.0\n *\n *     Unless required by applicable law or agreed to in writing, software\n *     distributed under the License is distributed on an \"AS IS\" BASIS,\n *     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *     See the License for the specific language governing permissions and\n *     limitations under the License.\n *\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TesterFactory = void 0;\nvar http_tester_1 = require(\"./http_tester\");\n/**\n * Initializes ProbeTesters for given recipes.\n */\nvar TesterFactory = /** @class */ (function () {\n    function TesterFactory() {\n    }\n    TesterFactory.prototype.getTester = function (requester, recipe) {\n        if (recipe.type == 'http_get') {\n            return new http_tester_1.HttpTester(requester, recipe.pulse_timeout);\n        }\n        throw new Error(recipe.type + \": inknown recipe type\");\n    };\n    return TesterFactory;\n}());\nexports.TesterFactory = TesterFactory;\n"],"sourceRoot":""}